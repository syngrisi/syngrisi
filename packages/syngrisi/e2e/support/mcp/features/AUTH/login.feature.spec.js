// Generated from: ../../features/AUTH/login.feature
import { test } from "../../../fixtures/index.ts";

test.describe('Login', () => {

  test.beforeEach('Background', async ({ Given, When, appServer, page, testData }, testInfo) => { if (testInfo.error) return;
    await When('I set env variables:', {"docString":{"content":"     SYNGRISI_TEST_MODE: \"true\"\n     SYNGRISI_AUTH: \"false\""}}, { appServer }); 
    await Given('I start Server', null, { appServer, testData }); 
    await When('I create via http test user', null, { appServer }); 
    await When('I stop Server', null, { appServer, testData }); 
    await When('I set env variables:', {"docString":{"content":"      SYNGRISI_TEST_MODE: \"false\"\n      SYNGRISI_AUTH: \"true\""}}, { appServer }); 
    await When('I reload session', null, { page, testData }); 
  });
  
  test('Login - Create user and login', { tag: ['@fast-server', '@smoke'] }, async ({ Given, When, appServer, page, testData }) => { 
    await When('I login via http with user:"Test" password "123456aA-"', null, { appServer, testData }); 
    await When('I create via http user as:"Test" with params:', {"docString":{"content":"{\n  \"username\": \"j_doe@gmail.com\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"role\": \"user\",\n  \"password\": \"Password-123\"\n}"}}, { appServer, testData }); 
    await Given('I stop Server', null, { appServer, testData }); 
    await When('I set env variables:', {"docString":{"content":"SYNGRISI_TEST_MODE: false\nSYNGRISI_AUTH: true"}}, { appServer }); 
    await When('I login with user:"j_doe@gmail.com" password "Password-123"', null, { appServer, page, testData }); 
    await When('I wait 30 seconds for the element with locator "span*=JD" to be visible', null, { page, testData }); 
  });

  test('Login - Wrong password', { tag: ['@fast-server', '@smoke'] }, async ({ When, Then, appServer, page, testData }) => { 
    await When('I login with user:"Test" password "Password-567"', null, { appServer, page, testData }); 
    await Then('the element with locator "#error-message" should have contains text "Authentication error: \'Password or username is incorrect\'"', null, { page, testData }); 
  });

  test('Login - Empty credentials', { tag: ['@fast-server'] }, async ({ When, Then, appServer, page, testData }) => { 
    await When('I login with user:"" password ""', null, { appServer, page, testData }); 
    await Then('the element with locator "#email" should have has attribute "required"', null, { page }); 
    await Then('the element with locator "#password" should have has attribute "required"', null, { page }); 
    await Then('the current url contains "/auth"', null, { page, testData }); 
    await Then('the element with locator "#email" should be visible', null, { page }); 
    await Then('the element with locator "#password" should be visible', null, { page }); 
  });

  test('Login - Invalid email', { tag: ['@fast-server'] }, async ({ When, Then, appServer, page, testData }) => { 
    await When('I login with user:"asd" password "PasswordInvEmail-567"', null, { appServer, page, testData }); 
    await Then('the element with locator ".mantine-Input-wrapper + div.mantine-InputWrapper-error" should have contains text "Invalid email"', null, { page, testData }); 
  });

  test('Redirect via origin url', { tag: ['@fast-server'] }, async ({ When, Then, page, testData }) => { 
    await When('I open the url "<syngrisiUrl>?groupBy=test-distinct%2FbrowserName"', null, { page, testData }); 
    await Then('the current url contains "?origin=%2F%3FgroupBy%3Dtest-distinct%252FbrowserName"', null, { page, testData }); 
    await When('I set "Test" to the inputfield "#email"', null, { page, testData }); 
    await When('I set "123456aA-" to the inputfield "#password"', null, { page, testData }); 
    await When('I click element with locator "#submit"', null, { page, testData }); 
    await Then('the current url contains "<syngrisiUrl>?groupBy=test-distinct%2FbrowserName"', null, { page, testData }); 
  });

});

// == technical section ==

test.use({
  $test: [({}, use) => use(test), { scope: 'test', box: true }],
  $uri: [({}, use) => use('../../features/AUTH/login.feature'), { scope: 'test', box: true }],
  $bddFileData: [({}, use) => use(bddFileData), { scope: "test", box: true }],
});

const bddFileData = [ // bdd-data-start
  {"pwTestLine":15,"pickleLine":25,"tags":["@fast-server","@smoke"],"steps":[{"pwStepLine":7,"gherkinStepLine":7,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":8,"gherkinStepLine":12,"keywordType":"Context","textWithKeyword":"Given I start Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":9,"gherkinStepLine":13,"keywordType":"Action","textWithKeyword":"When I create via http test user","isBg":true,"stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":14,"keywordType":"Action","textWithKeyword":"When I stop Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":11,"gherkinStepLine":15,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":12,"gherkinStepLine":22,"keywordType":"Action","textWithKeyword":"When I reload session","isBg":true,"stepMatchArguments":[]},{"pwStepLine":16,"gherkinStepLine":27,"keywordType":"Action","textWithKeyword":"When I login via http with user:\"Test\" password \"123456aA-\"","stepMatchArguments":[{"group":{"start":27,"value":"\"Test\"","children":[{"start":28,"value":"Test","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":43,"value":"\"123456aA-\"","children":[{"start":44,"value":"123456aA-","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":17,"gherkinStepLine":28,"keywordType":"Action","textWithKeyword":"When I create via http user as:\"Test\" with params:","stepMatchArguments":[{"group":{"start":26,"value":"\"Test\"","children":[{"start":27,"value":"Test","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":18,"gherkinStepLine":39,"keywordType":"Context","textWithKeyword":"Given I stop Server","stepMatchArguments":[]},{"pwStepLine":19,"gherkinStepLine":41,"keywordType":"Action","textWithKeyword":"When I set env variables:","stepMatchArguments":[]},{"pwStepLine":20,"gherkinStepLine":49,"keywordType":"Action","textWithKeyword":"When I login with user:\"j_doe@gmail.com\" password \"Password-123\"","stepMatchArguments":[{"group":{"start":18,"value":"\"j_doe@gmail.com\"","children":[{"start":19,"value":"j_doe@gmail.com","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":45,"value":"\"Password-123\"","children":[{"start":46,"value":"Password-123","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":21,"gherkinStepLine":50,"keywordType":"Action","textWithKeyword":"When I wait 30 seconds for the element with locator \"span*=JD\" to be visible","stepMatchArguments":[{"group":{"start":7,"value":"30","children":[]},"parameterTypeName":"int"},{"group":{"start":26,"value":"element","children":[]},"parameterTypeName":"role"},{"group":{"start":39,"value":"locator","children":[]},"parameterTypeName":"attribute"},{"group":{"start":47,"value":"\"span*=JD\"","children":[{"start":48,"value":"span*=JD","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":64,"value":"visible","children":[]},"parameterTypeName":"condition"}]}]},
  {"pwTestLine":24,"pickleLine":53,"tags":["@fast-server","@smoke"],"steps":[{"pwStepLine":7,"gherkinStepLine":7,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":8,"gherkinStepLine":12,"keywordType":"Context","textWithKeyword":"Given I start Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":9,"gherkinStepLine":13,"keywordType":"Action","textWithKeyword":"When I create via http test user","isBg":true,"stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":14,"keywordType":"Action","textWithKeyword":"When I stop Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":11,"gherkinStepLine":15,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":12,"gherkinStepLine":22,"keywordType":"Action","textWithKeyword":"When I reload session","isBg":true,"stepMatchArguments":[]},{"pwStepLine":25,"gherkinStepLine":54,"keywordType":"Action","textWithKeyword":"When I login with user:\"Test\" password \"Password-567\"","stepMatchArguments":[{"group":{"start":18,"value":"\"Test\"","children":[{"start":19,"value":"Test","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":34,"value":"\"Password-567\"","children":[{"start":35,"value":"Password-567","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":26,"gherkinStepLine":55,"keywordType":"Outcome","textWithKeyword":"Then the element with locator \"#error-message\" should have contains text \"Authentication error: 'Password or username is incorrect'\"","stepMatchArguments":[{"group":{"start":17,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":25,"value":"\"#error-message\"","children":[{"start":26,"value":"#error-message","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":68,"value":"\"Authentication error: 'Password or username is incorrect'\"","children":[{"start":69,"value":"Authentication error: 'Password or username is incorrect'","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":29,"pickleLine":57,"tags":["@fast-server"],"steps":[{"pwStepLine":7,"gherkinStepLine":7,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":8,"gherkinStepLine":12,"keywordType":"Context","textWithKeyword":"Given I start Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":9,"gherkinStepLine":13,"keywordType":"Action","textWithKeyword":"When I create via http test user","isBg":true,"stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":14,"keywordType":"Action","textWithKeyword":"When I stop Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":11,"gherkinStepLine":15,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":12,"gherkinStepLine":22,"keywordType":"Action","textWithKeyword":"When I reload session","isBg":true,"stepMatchArguments":[]},{"pwStepLine":30,"gherkinStepLine":58,"keywordType":"Action","textWithKeyword":"When I login with user:\"\" password \"\"","stepMatchArguments":[{"group":{"start":18,"value":"\"\"","children":[{"start":19,"value":"","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":30,"value":"\"\"","children":[{"start":31,"value":"","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":31,"gherkinStepLine":60,"keywordType":"Outcome","textWithKeyword":"Then the element with locator \"#email\" should have has attribute \"required\"","stepMatchArguments":[{"group":{"start":17,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":25,"value":"\"#email\"","children":[{"start":26,"value":"#email","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":60,"value":"\"required\"","children":[{"start":61,"value":"required","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":32,"gherkinStepLine":61,"keywordType":"Outcome","textWithKeyword":"Then the element with locator \"#password\" should have has attribute \"required\"","stepMatchArguments":[{"group":{"start":17,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":25,"value":"\"#password\"","children":[{"start":26,"value":"#password","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":63,"value":"\"required\"","children":[{"start":64,"value":"required","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":33,"gherkinStepLine":62,"keywordType":"Outcome","textWithKeyword":"Then the current url contains \"/auth\"","stepMatchArguments":[{"group":{"start":25,"value":"\"/auth\"","children":[{"start":26,"value":"/auth","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":34,"gherkinStepLine":63,"keywordType":"Outcome","textWithKeyword":"Then the element with locator \"#email\" should be visible","stepMatchArguments":[{"group":{"start":17,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":25,"value":"\"#email\"","children":[{"start":26,"value":"#email","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":44,"value":"visible","children":[]},"parameterTypeName":"condition"}]},{"pwStepLine":35,"gherkinStepLine":64,"keywordType":"Outcome","textWithKeyword":"Then the element with locator \"#password\" should be visible","stepMatchArguments":[{"group":{"start":17,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":25,"value":"\"#password\"","children":[{"start":26,"value":"#password","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":47,"value":"visible","children":[]},"parameterTypeName":"condition"}]}]},
  {"pwTestLine":38,"pickleLine":66,"tags":["@fast-server"],"steps":[{"pwStepLine":7,"gherkinStepLine":7,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":8,"gherkinStepLine":12,"keywordType":"Context","textWithKeyword":"Given I start Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":9,"gherkinStepLine":13,"keywordType":"Action","textWithKeyword":"When I create via http test user","isBg":true,"stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":14,"keywordType":"Action","textWithKeyword":"When I stop Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":11,"gherkinStepLine":15,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":12,"gherkinStepLine":22,"keywordType":"Action","textWithKeyword":"When I reload session","isBg":true,"stepMatchArguments":[]},{"pwStepLine":39,"gherkinStepLine":67,"keywordType":"Action","textWithKeyword":"When I login with user:\"asd\" password \"PasswordInvEmail-567\"","stepMatchArguments":[{"group":{"start":18,"value":"\"asd\"","children":[{"start":19,"value":"asd","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":33,"value":"\"PasswordInvEmail-567\"","children":[{"start":34,"value":"PasswordInvEmail-567","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":40,"gherkinStepLine":68,"keywordType":"Outcome","textWithKeyword":"Then the element with locator \".mantine-Input-wrapper + div.mantine-InputWrapper-error\" should have contains text \"Invalid email\"","stepMatchArguments":[{"group":{"start":17,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":25,"value":"\".mantine-Input-wrapper + div.mantine-InputWrapper-error\"","children":[{"start":26,"value":".mantine-Input-wrapper + div.mantine-InputWrapper-error","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":109,"value":"\"Invalid email\"","children":[{"start":110,"value":"Invalid email","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":43,"pickleLine":70,"tags":["@fast-server"],"steps":[{"pwStepLine":7,"gherkinStepLine":7,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":8,"gherkinStepLine":12,"keywordType":"Context","textWithKeyword":"Given I start Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":9,"gherkinStepLine":13,"keywordType":"Action","textWithKeyword":"When I create via http test user","isBg":true,"stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":14,"keywordType":"Action","textWithKeyword":"When I stop Server","isBg":true,"stepMatchArguments":[]},{"pwStepLine":11,"gherkinStepLine":15,"keywordType":"Action","textWithKeyword":"When I set env variables:","isBg":true,"stepMatchArguments":[]},{"pwStepLine":12,"gherkinStepLine":22,"keywordType":"Action","textWithKeyword":"When I reload session","isBg":true,"stepMatchArguments":[]},{"pwStepLine":44,"gherkinStepLine":71,"keywordType":"Action","textWithKeyword":"When I open the url \"<syngrisiUrl>?groupBy=test-distinct%2FbrowserName\"","stepMatchArguments":[{"group":{"start":15,"value":"\"<syngrisiUrl>?groupBy=test-distinct%2FbrowserName\"","children":[{"start":16,"value":"<syngrisiUrl>?groupBy=test-distinct%2FbrowserName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":45,"gherkinStepLine":72,"keywordType":"Outcome","textWithKeyword":"Then the current url contains \"?origin=%2F%3FgroupBy%3Dtest-distinct%252FbrowserName\"","stepMatchArguments":[{"group":{"start":25,"value":"\"?origin=%2F%3FgroupBy%3Dtest-distinct%252FbrowserName\"","children":[{"start":26,"value":"?origin=%2F%3FgroupBy%3Dtest-distinct%252FbrowserName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":46,"gherkinStepLine":73,"keywordType":"Action","textWithKeyword":"When I set \"Test\" to the inputfield \"#email\"","stepMatchArguments":[{"group":{"start":6,"value":"\"Test\"","children":[{"start":7,"value":"Test","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":31,"value":"\"#email\"","children":[{"start":32,"value":"#email","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":47,"gherkinStepLine":74,"keywordType":"Action","textWithKeyword":"When I set \"123456aA-\" to the inputfield \"#password\"","stepMatchArguments":[{"group":{"start":6,"value":"\"123456aA-\"","children":[{"start":7,"value":"123456aA-","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":36,"value":"\"#password\"","children":[{"start":37,"value":"#password","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":48,"gherkinStepLine":75,"keywordType":"Action","textWithKeyword":"When I click element with locator \"#submit\"","stepMatchArguments":[{"group":{"start":21,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":29,"value":"\"#submit\"","children":[{"start":30,"value":"#submit","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":49,"gherkinStepLine":76,"keywordType":"Outcome","textWithKeyword":"Then the current url contains \"<syngrisiUrl>?groupBy=test-distinct%2FbrowserName\"","stepMatchArguments":[{"group":{"start":25,"value":"\"<syngrisiUrl>?groupBy=test-distinct%2FbrowserName\"","children":[{"start":26,"value":"<syngrisiUrl>?groupBy=test-distinct%2FbrowserName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
]; // bdd-data-end