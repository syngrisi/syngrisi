// Generated from: ../../features/AP/tasks/cli_tasks.feature
import { test } from "../../../../fixtures/index.ts";

test.describe('CLI Tasks', () => {

  test('CLI - Handle Database Consistency [statistics only]', { tag: ['@smoke', '@fast-server'] }, async ({ Given, When, Then, appServer, testData }) => { 
    await When('I create "1" tests with params:', {"docString":{"content":"run: RunName\nsuite: SuiteName\ntestName: TestName\ncheckName: CheckName"}}, { appServer, testData }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
    await Given('I stop Server', null, { appServer, testData }); 
    await When('I clear database', null, { appServer, testData }); 
    await When('I create "1" tests with params:', {"docString":{"content":"run: RunName\nsuite: SuiteName\ntestName: TestName\ncheckName: CheckName"}}, { appServer, testData }); 
    await Then('I expect exact "2" snapshot files', null, { appServer, testData }); 
    await When('I run CLI task "consistency" with args ""', null, { appServer }); 
    await Then('I expect exact "2" snapshot files', null, { appServer, testData }); 
  });

  test('CLI - Handle Database Consistency [clean]', { tag: ['@smoke', '@fast-server'] }, async ({ Given, When, Then, appServer, testData }) => { 
    await When('I create "1" tests with params:', {"docString":{"content":"run: RunName\nsuite: SuiteName\ntestName: TestName\ncheckName: CheckName"}}, { appServer, testData }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
    await Given('I stop Server', null, { appServer, testData }); 
    await When('I clear database', null, { appServer, testData }); 
    await When('I create "1" tests with params:', {"docString":{"content":"run: RunName\nsuite: SuiteName\ntestName: TestName\ncheckName: CheckName"}}, { appServer, testData }); 
    await Then('I expect exact "2" snapshot files', null, { appServer, testData }); 
    await When('I run CLI task "consistency" with args "--clean --yes"', null, { appServer }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
  });

  test('CLI - Handle Old Checks [statistics only]', { tag: ['@smoke', '@fast-server'] }, async ({ When, Then, appServer, testData }) => { 
    await When('I create "1" tests with:', {"docString":{"content":"testName: TestName\nchecks:\n  - checkName: unaccepted\n    filePath: files/A.png"}}, { appServer, testData }); 
    await When('I update via http check with params:', {"docString":{"content":"createdDate: <currentDate-10>"}}, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" check exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" snapshot exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
    await When('I run CLI task "old-checks" with args "--days 9"', null, { appServer }); 
    await Then('I expect via http that "unaccepted" check exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" snapshot exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
  });

  test('CLI - Handle Old Checks [remove]', { tag: ['@smoke', '@fast-server'] }, async ({ When, Then, appServer, testData }) => { 
    await When('I create "1" tests with:', {"docString":{"content":"testName: TestName\nchecks:\n  - checkName: unaccepted\n    filePath: files/A.png"}}, { appServer, testData }); 
    await When('I update via http check with params:', {"docString":{"content":"createdDate: <currentDate-10>"}}, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" check exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" snapshot exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
    await When('I run CLI task "old-checks" with args "--days 9 --remove"', null, { appServer }); 
    await Then('I expect via http that "unaccepted" check exist exactly "0" times', null, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" snapshot exist exactly "0" times', null, { appServer, testData }); 
    await Then('I expect exact "0" snapshot files', null, { appServer, testData }); 
  });

  test('CLI - Handle Old Checks [positional arguments]', { tag: ['@smoke', '@fast-server'] }, async ({ When, Then, appServer, testData }) => { 
    await When('I create "1" tests with:', {"docString":{"content":"testName: TestName\nchecks:\n  - checkName: unaccepted\n    filePath: files/A.png"}}, { appServer, testData }); 
    await When('I update via http check with params:', {"docString":{"content":"createdDate: <currentDate-10>"}}, { appServer, testData }); 
    await Then('I expect via http that "unaccepted" check exist exactly "1" times', null, { appServer, testData }); 
    await Then('I expect exact "1" snapshot files', null, { appServer, testData }); 
    await When('I run CLI task "old-checks" with args "9 true"', null, { appServer }); 
    await Then('I expect via http that "unaccepted" check exist exactly "0" times', null, { appServer, testData }); 
    await Then('I expect exact "0" snapshot files', null, { appServer, testData }); 
  });

});

// == technical section ==

test.use({
  $test: [({}, use) => use(test), { scope: 'test', box: true }],
  $uri: [({}, use) => use('../../features/AP/tasks/cli_tasks.feature'), { scope: 'test', box: true }],
  $bddFileData: [({}, use) => use(bddFileData), { scope: "test", box: true }],
});

const bddFileData = [ // bdd-data-start
  {"pwTestLine":6,"pickleLine":8,"tags":["@smoke","@fast-server"],"steps":[{"pwStepLine":7,"gherkinStepLine":9,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with params:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":8,"gherkinStepLine":16,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":9,"gherkinStepLine":17,"keywordType":"Context","textWithKeyword":"Given I stop Server","stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":18,"keywordType":"Action","textWithKeyword":"When I clear database","stepMatchArguments":[]},{"pwStepLine":11,"gherkinStepLine":21,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with params:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":12,"gherkinStepLine":28,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"2\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"2\"","children":[{"start":16,"value":"2","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":13,"gherkinStepLine":29,"keywordType":"Action","textWithKeyword":"When I run CLI task \"consistency\" with args \"\"","stepMatchArguments":[{"group":{"start":15,"value":"\"consistency\"","children":[{"start":16,"value":"consistency","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":39,"value":"\"\"","children":[{"start":40,"value":"","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":14,"gherkinStepLine":30,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"2\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"2\"","children":[{"start":16,"value":"2","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":17,"pickleLine":32,"tags":["@smoke","@fast-server"],"steps":[{"pwStepLine":18,"gherkinStepLine":33,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with params:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":19,"gherkinStepLine":40,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":20,"gherkinStepLine":41,"keywordType":"Context","textWithKeyword":"Given I stop Server","stepMatchArguments":[]},{"pwStepLine":21,"gherkinStepLine":42,"keywordType":"Action","textWithKeyword":"When I clear database","stepMatchArguments":[]},{"pwStepLine":22,"gherkinStepLine":45,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with params:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":23,"gherkinStepLine":52,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"2\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"2\"","children":[{"start":16,"value":"2","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":24,"gherkinStepLine":53,"keywordType":"Action","textWithKeyword":"When I run CLI task \"consistency\" with args \"--clean --yes\"","stepMatchArguments":[{"group":{"start":15,"value":"\"consistency\"","children":[{"start":16,"value":"consistency","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":39,"value":"\"--clean --yes\"","children":[{"start":40,"value":"--clean --yes","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":25,"gherkinStepLine":54,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":28,"pickleLine":56,"tags":["@smoke","@fast-server"],"steps":[{"pwStepLine":29,"gherkinStepLine":57,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":30,"gherkinStepLine":64,"keywordType":"Action","textWithKeyword":"When I update via http check with params:","stepMatchArguments":[]},{"pwStepLine":31,"gherkinStepLine":68,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" check exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":56,"value":"\"1\"","children":[{"start":57,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":32,"gherkinStepLine":69,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" snapshot exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":59,"value":"\"1\"","children":[{"start":60,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":33,"gherkinStepLine":70,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":34,"gherkinStepLine":72,"keywordType":"Action","textWithKeyword":"When I run CLI task \"old-checks\" with args \"--days 9\"","stepMatchArguments":[{"group":{"start":15,"value":"\"old-checks\"","children":[{"start":16,"value":"old-checks","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":38,"value":"\"--days 9\"","children":[{"start":39,"value":"--days 9","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":35,"gherkinStepLine":74,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" check exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":56,"value":"\"1\"","children":[{"start":57,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":36,"gherkinStepLine":75,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" snapshot exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":59,"value":"\"1\"","children":[{"start":60,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":37,"gherkinStepLine":76,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":40,"pickleLine":78,"tags":["@smoke","@fast-server"],"steps":[{"pwStepLine":41,"gherkinStepLine":79,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":42,"gherkinStepLine":86,"keywordType":"Action","textWithKeyword":"When I update via http check with params:","stepMatchArguments":[]},{"pwStepLine":43,"gherkinStepLine":90,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" check exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":56,"value":"\"1\"","children":[{"start":57,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":44,"gherkinStepLine":91,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" snapshot exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":59,"value":"\"1\"","children":[{"start":60,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":45,"gherkinStepLine":92,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":46,"gherkinStepLine":94,"keywordType":"Action","textWithKeyword":"When I run CLI task \"old-checks\" with args \"--days 9 --remove\"","stepMatchArguments":[{"group":{"start":15,"value":"\"old-checks\"","children":[{"start":16,"value":"old-checks","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":38,"value":"\"--days 9 --remove\"","children":[{"start":39,"value":"--days 9 --remove","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":47,"gherkinStepLine":96,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" check exist exactly \"0\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":56,"value":"\"0\"","children":[{"start":57,"value":"0","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":48,"gherkinStepLine":97,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" snapshot exist exactly \"0\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":59,"value":"\"0\"","children":[{"start":60,"value":"0","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":49,"gherkinStepLine":98,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"0\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"0\"","children":[{"start":16,"value":"0","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":52,"pickleLine":100,"tags":["@smoke","@fast-server"],"steps":[{"pwStepLine":53,"gherkinStepLine":101,"keywordType":"Action","textWithKeyword":"When I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":54,"gherkinStepLine":108,"keywordType":"Action","textWithKeyword":"When I update via http check with params:","stepMatchArguments":[]},{"pwStepLine":55,"gherkinStepLine":112,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" check exist exactly \"1\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":56,"value":"\"1\"","children":[{"start":57,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":56,"gherkinStepLine":113,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"1\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"1\"","children":[{"start":16,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":57,"gherkinStepLine":115,"keywordType":"Action","textWithKeyword":"When I run CLI task \"old-checks\" with args \"9 true\"","stepMatchArguments":[{"group":{"start":15,"value":"\"old-checks\"","children":[{"start":16,"value":"old-checks","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":38,"value":"\"9 true\"","children":[{"start":39,"value":"9 true","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":58,"gherkinStepLine":117,"keywordType":"Outcome","textWithKeyword":"Then I expect via http that \"unaccepted\" check exist exactly \"0\" times","stepMatchArguments":[{"group":{"start":23,"value":"\"unaccepted\"","children":[{"start":24,"value":"unaccepted","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":56,"value":"\"0\"","children":[{"start":57,"value":"0","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":59,"gherkinStepLine":118,"keywordType":"Outcome","textWithKeyword":"Then I expect exact \"0\" snapshot files","stepMatchArguments":[{"group":{"start":15,"value":"\"0\"","children":[{"start":16,"value":"0","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
]; // bdd-data-end