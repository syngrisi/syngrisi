// Generated from: ../../features/CP/check_details/initial_resize.feature
import { test } from "../../../../fixtures/index.ts";

test.describe('Check Details - Initial image resize', () => {

  test('Image fit in the viewport', { tag: ['@fast-server'] }, async ({ Given, When, Then, appServer, page, testData }) => { 
    await Given('I create "1" tests with:', {"docString":{"content":"    testName: TestName\n    checks:\n      - checkName: CheckName\n        filePath: files/normal.png"}}, { appServer, testData }); 
    await When('I set window size: "1440x900"', null, { page }); 
    await When('I open the app', null, { appServer, page, testData }); 
    await When('I unfold the test "TestName"', null, { page, testData }); 
    await When('I click element with locator "[data-test-preview-image=\'CheckName\']"', null, { page, testData }); 
    await When('I wait 30 seconds for the element with locator "[data-check-header-name=\'CheckName\']" to be visible', null, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5]"}}, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return (mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5] === '362.5_0'\n|| mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5] === '340_0'\n|| mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5] === '340.5_0'\n|| mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5] === '350_0'\n|| (parseFloat(mainView.canvas.viewportTransform[4]) >= 335 && parseFloat(mainView.canvas.viewportTransform[4]) <= 365 && mainView.canvas.viewportTransform[5] === 0))"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"true"}}, { testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return mainView.canvas.getZoom()"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"1"}}, { testData }); 
  });

  test('Image is too small', { tag: ['@fast-server'] }, async ({ Given, When, Then, appServer, page, testData }) => { 
    await Given('I create "1" tests with:', {"docString":{"content":"    testName: TestName\n    checks:\n      - checkName: CheckName\n        filePath: files/small.png"}}, { appServer, testData }); 
    await When('I set window size: "1440x900"', null, { page }); 
    await When('I open the app', null, { appServer, page, testData }); 
    await When('I unfold the test "TestName"', null, { page, testData }); 
    await When('I click element with locator "[data-test-preview-image=\'CheckName\']"', null, { page, testData }); 
    await When('I wait 30 seconds for the element with locator "[data-check-header-name=\'CheckName\']" to be visible', null, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5]"}}, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"const translateX = parseFloat(mainView.canvas.viewportTransform[4]);\nconst translateY = parseFloat(mainView.canvas.viewportTransform[5]);\nconst allowed = [332.5, 310, 310.5];\nconst tolerance = 20;\n\nconst matchesTolerance = allowed.some(\n    (target) => Math.abs(translateX - target) <= tolerance && Math.abs(translateY) <= 0.5\n);\n\nreturn matchesTolerance;"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"true"}}, { testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return mainView.canvas.getZoom()"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"3.5"}}, { testData }); 
  });

  test('Image is too high', { tag: ['@fast-server'] }, async ({ Given, When, Then, appServer, page, testData }) => { 
    await Given('I create "1" tests with:', {"docString":{"content":"    testName: TestName\n    checks:\n      - checkName: CheckName\n        filePath: files/extra_heigh_image.png"}}, { appServer, testData }); 
    await When('I set window size: "1440x900"', null, { page }); 
    await When('I open the app', null, { appServer, page, testData }); 
    await When('I unfold the test "TestName"', null, { page, testData }); 
    await When('I click element with locator "[data-test-preview-image=\'CheckName\']"', null, { page, testData }); 
    await When('I wait 30 seconds for the element with locator "[data-check-header-name=\'CheckName\']" to be visible', null, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return mainView.canvas.viewportTransform[4] + '_' + mainView.canvas.viewportTransform[5]"}}, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"const translateX = parseInt(mainView.canvas.viewportTransform[4]);\nconst translateY = parseInt(mainView.canvas.viewportTransform[5]);\nconst allowedX = [528, 529, 530, 531, 532, 533, 534, 535, 536, 537, 538, 539, 540, 541, 542, 543, 544, 545];\nconst tolerance = 20;\n\nconst matchesTolerance = allowedX.some(\n    (target) => Math.abs(translateX - target) <= tolerance && Math.abs(translateY) <= 0.5\n);\n\nreturn matchesTolerance;"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"true"}}, { testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return (mainView.canvas.getZoom().toFixed(2))"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"0.04"}}, { testData }); 
  });

  test('Image is too wide', { tag: ['@fast-server'] }, async ({ Given, When, Then, appServer, page, testData }) => { 
    await Given('I create "1" tests with:', {"docString":{"content":"    testName: TestName\n    checks:\n      - checkName: CheckName\n        filePath: files/extra_wide.png"}}, { appServer, testData }); 
    await When('I set window size: "1440x900"', null, { page }); 
    await When('I open the app', null, { appServer, page, testData }); 
    await When('I unfold the test "TestName"', null, { page, testData }); 
    await When('I click element with locator "[data-test-preview-image=\'CheckName\']"', null, { page, testData }); 
    await When('I wait 30 seconds for the element with locator "[data-check-header-name=\'CheckName\']" to be visible', null, { page, testData }); 
    await When('I execute javascript code:', {"docString":{"content":"const translateX = parseFloat(mainView.canvas.viewportTransform[4]);\nconst translateY = parseFloat(mainView.canvas.viewportTransform[5]);\n// Allow small deviation from 0 to account for browser rendering differences\nreturn Math.abs(translateX) < 5 && Math.abs(translateY) < 5;"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"true"}}, { testData }); 
    await When('I execute javascript code:', {"docString":{"content":"return  (0.44 < (mainView.canvas.getZoom().toFixed(2)))\n&& (0.50 > (mainView.canvas.getZoom().toFixed(2)))"}}, { page, testData }); 
    await Then('I expect the stored "js" string is equal:', {"docString":{"content":"true"}}, { testData }); 
  });

});

// == technical section ==

test.use({
  $test: [({}, use) => use(test), { scope: 'test', box: true }],
  $uri: [({}, use) => use('../../features/CP/check_details/initial_resize.feature'), { scope: 'test', box: true }],
  $bddFileData: [({}, use) => use(bddFileData), { scope: "test", box: true }],
});

const bddFileData = [ // bdd-data-start
  {"pwTestLine":6,"pickleLine":8,"tags":["@fast-server"],"steps":[{"pwStepLine":7,"gherkinStepLine":9,"keywordType":"Context","textWithKeyword":"Given I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":8,"gherkinStepLine":16,"keywordType":"Action","textWithKeyword":"When I set window size: \"1440x900\"","stepMatchArguments":[{"group":{"start":19,"value":"\"1440x900\"","children":[{"start":20,"value":"1440x900","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":9,"gherkinStepLine":17,"keywordType":"Action","textWithKeyword":"When I open the app","stepMatchArguments":[]},{"pwStepLine":10,"gherkinStepLine":18,"keywordType":"Action","textWithKeyword":"When I unfold the test \"TestName\"","stepMatchArguments":[{"group":{"start":18,"value":"\"TestName\"","children":[{"start":19,"value":"TestName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":11,"gherkinStepLine":19,"keywordType":"Action","textWithKeyword":"When I click element with locator \"[data-test-preview-image='CheckName']\"","stepMatchArguments":[{"group":{"start":21,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":29,"value":"\"[data-test-preview-image='CheckName']\"","children":[{"start":30,"value":"[data-test-preview-image='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":12,"gherkinStepLine":20,"keywordType":"Action","textWithKeyword":"When I wait 30 seconds for the element with locator \"[data-check-header-name='CheckName']\" to be visible","stepMatchArguments":[{"group":{"start":7,"value":"30","children":[]},"parameterTypeName":"int"},{"group":{"start":26,"value":"element","children":[]},"parameterTypeName":"role"},{"group":{"start":39,"value":"locator","children":[]},"parameterTypeName":"attribute"},{"group":{"start":47,"value":"\"[data-check-header-name='CheckName']\"","children":[{"start":48,"value":"[data-check-header-name='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":92,"value":"visible","children":[]},"parameterTypeName":"condition"}]},{"pwStepLine":13,"gherkinStepLine":21,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":14,"gherkinStepLine":26,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":15,"gherkinStepLine":34,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":16,"gherkinStepLine":39,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":17,"gherkinStepLine":43,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":20,"pickleLine":48,"tags":["@fast-server"],"steps":[{"pwStepLine":21,"gherkinStepLine":49,"keywordType":"Context","textWithKeyword":"Given I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":22,"gherkinStepLine":56,"keywordType":"Action","textWithKeyword":"When I set window size: \"1440x900\"","stepMatchArguments":[{"group":{"start":19,"value":"\"1440x900\"","children":[{"start":20,"value":"1440x900","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":23,"gherkinStepLine":57,"keywordType":"Action","textWithKeyword":"When I open the app","stepMatchArguments":[]},{"pwStepLine":24,"gherkinStepLine":58,"keywordType":"Action","textWithKeyword":"When I unfold the test \"TestName\"","stepMatchArguments":[{"group":{"start":18,"value":"\"TestName\"","children":[{"start":19,"value":"TestName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":25,"gherkinStepLine":59,"keywordType":"Action","textWithKeyword":"When I click element with locator \"[data-test-preview-image='CheckName']\"","stepMatchArguments":[{"group":{"start":21,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":29,"value":"\"[data-test-preview-image='CheckName']\"","children":[{"start":30,"value":"[data-test-preview-image='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":26,"gherkinStepLine":60,"keywordType":"Action","textWithKeyword":"When I wait 30 seconds for the element with locator \"[data-check-header-name='CheckName']\" to be visible","stepMatchArguments":[{"group":{"start":7,"value":"30","children":[]},"parameterTypeName":"int"},{"group":{"start":26,"value":"element","children":[]},"parameterTypeName":"role"},{"group":{"start":39,"value":"locator","children":[]},"parameterTypeName":"attribute"},{"group":{"start":47,"value":"\"[data-check-header-name='CheckName']\"","children":[{"start":48,"value":"[data-check-header-name='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":92,"value":"visible","children":[]},"parameterTypeName":"condition"}]},{"pwStepLine":27,"gherkinStepLine":61,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":28,"gherkinStepLine":65,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":29,"gherkinStepLine":78,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":30,"gherkinStepLine":83,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":31,"gherkinStepLine":87,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":34,"pickleLine":92,"tags":["@fast-server"],"steps":[{"pwStepLine":35,"gherkinStepLine":93,"keywordType":"Context","textWithKeyword":"Given I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":36,"gherkinStepLine":100,"keywordType":"Action","textWithKeyword":"When I set window size: \"1440x900\"","stepMatchArguments":[{"group":{"start":19,"value":"\"1440x900\"","children":[{"start":20,"value":"1440x900","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":37,"gherkinStepLine":101,"keywordType":"Action","textWithKeyword":"When I open the app","stepMatchArguments":[]},{"pwStepLine":38,"gherkinStepLine":102,"keywordType":"Action","textWithKeyword":"When I unfold the test \"TestName\"","stepMatchArguments":[{"group":{"start":18,"value":"\"TestName\"","children":[{"start":19,"value":"TestName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":39,"gherkinStepLine":103,"keywordType":"Action","textWithKeyword":"When I click element with locator \"[data-test-preview-image='CheckName']\"","stepMatchArguments":[{"group":{"start":21,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":29,"value":"\"[data-test-preview-image='CheckName']\"","children":[{"start":30,"value":"[data-test-preview-image='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":40,"gherkinStepLine":104,"keywordType":"Action","textWithKeyword":"When I wait 30 seconds for the element with locator \"[data-check-header-name='CheckName']\" to be visible","stepMatchArguments":[{"group":{"start":7,"value":"30","children":[]},"parameterTypeName":"int"},{"group":{"start":26,"value":"element","children":[]},"parameterTypeName":"role"},{"group":{"start":39,"value":"locator","children":[]},"parameterTypeName":"attribute"},{"group":{"start":47,"value":"\"[data-check-header-name='CheckName']\"","children":[{"start":48,"value":"[data-check-header-name='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":92,"value":"visible","children":[]},"parameterTypeName":"condition"}]},{"pwStepLine":41,"gherkinStepLine":105,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":42,"gherkinStepLine":109,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":43,"gherkinStepLine":122,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":44,"gherkinStepLine":127,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":45,"gherkinStepLine":131,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
  {"pwTestLine":48,"pickleLine":136,"tags":["@fast-server"],"steps":[{"pwStepLine":49,"gherkinStepLine":137,"keywordType":"Context","textWithKeyword":"Given I create \"1\" tests with:","stepMatchArguments":[{"group":{"start":9,"value":"\"1\"","children":[{"start":10,"value":"1","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":50,"gherkinStepLine":144,"keywordType":"Action","textWithKeyword":"When I set window size: \"1440x900\"","stepMatchArguments":[{"group":{"start":19,"value":"\"1440x900\"","children":[{"start":20,"value":"1440x900","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":51,"gherkinStepLine":145,"keywordType":"Action","textWithKeyword":"When I open the app","stepMatchArguments":[]},{"pwStepLine":52,"gherkinStepLine":146,"keywordType":"Action","textWithKeyword":"When I unfold the test \"TestName\"","stepMatchArguments":[{"group":{"start":18,"value":"\"TestName\"","children":[{"start":19,"value":"TestName","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":53,"gherkinStepLine":147,"keywordType":"Action","textWithKeyword":"When I click element with locator \"[data-test-preview-image='CheckName']\"","stepMatchArguments":[{"group":{"start":21,"value":"locator","children":[]},"parameterTypeName":"target"},{"group":{"start":29,"value":"\"[data-test-preview-image='CheckName']\"","children":[{"start":30,"value":"[data-test-preview-image='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":54,"gherkinStepLine":148,"keywordType":"Action","textWithKeyword":"When I wait 30 seconds for the element with locator \"[data-check-header-name='CheckName']\" to be visible","stepMatchArguments":[{"group":{"start":7,"value":"30","children":[]},"parameterTypeName":"int"},{"group":{"start":26,"value":"element","children":[]},"parameterTypeName":"role"},{"group":{"start":39,"value":"locator","children":[]},"parameterTypeName":"attribute"},{"group":{"start":47,"value":"\"[data-check-header-name='CheckName']\"","children":[{"start":48,"value":"[data-check-header-name='CheckName']","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"},{"group":{"start":92,"value":"visible","children":[]},"parameterTypeName":"condition"}]},{"pwStepLine":55,"gherkinStepLine":149,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":56,"gherkinStepLine":156,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]},{"pwStepLine":57,"gherkinStepLine":161,"keywordType":"Action","textWithKeyword":"When I execute javascript code:","stepMatchArguments":[]},{"pwStepLine":58,"gherkinStepLine":166,"keywordType":"Outcome","textWithKeyword":"Then I expect the stored \"js\" string is equal:","stepMatchArguments":[{"group":{"start":20,"value":"\"js\"","children":[{"start":21,"value":"js","children":[{"children":[]}]},{"children":[{"children":[]}]}]},"parameterTypeName":"string"}]}]},
]; // bdd-data-end