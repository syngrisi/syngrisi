# Спецификация: Навигация в Check Details

## Обзор

Эта функция добавляет возможность навигации между проверками (checks) и тестами (tests) непосредственно из окна деталей проверки (Check Details).

## Требования

### Навигация между проверками (Влево/Вправо)

-   В тулбар Check Details добавляются кнопки с иконками стрелок влево (`<-`) и вправо (`->`).
-   Кнопки позволяют переключаться между проверками **в рамках одного теста**.
-   Порядок навигации соответствует порядку расположения проверок в списке проверок теста (обычно по дате создания, новые сверху, или как настроено в view).
-   **Граничные условия**:
    -   Если открыт **первый** чек в списке, кнопка "Влево" (или "Предыдущий") должна быть неактивна.
    -   Если открыт **последний** чек в списке, кнопка "Вправо" (или "Следующий") должна быть неактивна.

### Навигация между тестами (Вверх/Вниз)

-   В тулбар добавляются кнопки с иконками стрелок вверх и вниз.
-   Кнопки позволяют переключаться между **тестами**, отображаемыми в текущей таблице тестов (Grid).
-   Порядок навигации соответствует порядку тестов в таблице (с учетом текущей фильтрации и сортировки).
-   При переходе к другому тесту должен открываться **первый** (самый новый) чек этого теста.
-   **Граничные условия**:
    -   Если текущий тест является **первым** в таблице, кнопка "Вверх" (или "Предыдущий тест") должна быть неактивна.
    -   Если текущий тест является **последним** в таблице, кнопка "Вниз" (или "Следующий тест") должна быть неактивна.

## Техническая реализация

### Компоненты

1.  **TestsTable**:
    -   Передает список текущих тестов (`flatData`) в компонент `CheckModal`.
2.  **CheckModal**:
    -   Принимает список тестов и передает его в `CheckDetails`.
3.  **CheckDetails**:
    -   Получает список тестов.
    -   Загружает список проверок для текущего теста (sibling checks) для определения порядка навигации внутри теста.
    -   Вычисляет ID следующего/предыдущего чека и следующего/предыдущего теста.
    -   Передает функции навигации и состояния кнопок (disabled) в `Toolbar`.
4.  **Toolbar**:
    -   Отображает 4 кнопки навигации.
    -   Обрабатывает клики, вызывая соответствующие функции навигации.

### Логика навигации

-   **Внутри теста**:
    -   Используется запрос `checks` с фильтром по `testId` и сортировкой (аналогично тому, как они отображаются в списке).
    -   Определяется индекс текущего чека.
    -   Переход осуществляется путем изменения URL параметра `checkId`.
-   **Между тестами**:
    -   Используется переданный массив тестов.
    -   Определяется индекс текущего теста.
    -   При переходе берется ID целевого теста.
    -   Делается запрос за чеками целевого теста (limit 1, sort by created date desc).
    -   Переход осуществляется путем изменения URL параметра `checkId` на ID полученного чека.

## План выполнения

1.  [x] Создать спецификацию.
2.  [x] Обновить `TestsTable.tsx` для передачи данных о тестах в модальное окно.
3.  [x] Обновить `CheckModal.tsx` для прокидывания пропсов.
4.  [x] Реализовать логику загрузки соседних чеков и навигации в `CheckDetails.tsx`.
5.  [x] Добавить кнопки навигации в `Toolbar.tsx`.
6.  [x] Написать E2E тесты в `packages/syngrisi/e2e/features/CP/check_details/navigation.feature`.

## Статус реализации

✅ **Все функции реализованы и работают:**

-   ✅ Навигация между чеками (стрелки влево/вправо)
-   ✅ Навигация между тестами (стрелки вверх/вниз)
-   ✅ Граничные условия (disabled для первого/последнего элемента)
-   ✅ Загрузка sibling checks через API
-   ✅ Переход к первому чеку при смене теста
-   ✅ E2E тесты покрывают все сценарии

**Примечание:** E2E тесты требуют небольших корректировок в шагах для стабильной работы с UI элементами.
