# Бенчмарк Gemini + Syngrisi MCP

Данный бенчмарк проверяет способность агента Gemini работать с MCP-сервером `packages/syngrisi/e2e/support/mcp`, соблюдать правила из `packages/syngrisi/e2e/AGENTS.md` и руководств `packages/syngrisi/docs/agent/guides/*.md`.

## Подготовка окружения
- Запусти MCP сервер в отдельном терминале:
  - Headed: `cd packages/syngrisi/e2e && npm run test:mcp:headed`
  - Headless: `cd packages/syngrisi/e2e && MCP_KEEP_ALIVE=0 E2E_HEADLESS=1 npm run test:mcp`
- Убедись, что CLI `gemini` доступен и поддерживает вызов MCP через `--yolo`.
- Перед каждой новой сессией очищай старые процессы при необходимости: `cd packages/syngrisi/e2e/support/mcp && ./kill-mcp.sh`.

## Общие правила выполнения заданий
- Все промпты даются на русском, но шаги и комментарии в коде должны быть на английском.
- Агента нужно запускать через MCP: пример шаблона `gemini --model gemini-2.5-flash --yolo -p "<PROMPT>"`.
- В каждом задании явно напоминать про:
  - Строгий порядок селекторов и запрет на ослабление проверок из `packages/syngrisi/e2e/AGENTS.md`.
  - Использование шагов из сгенерированных YAML в `packages/syngrisi/e2e/support/mcp/steps/` и руководств в `packages/syngrisi/docs/agent/guides`.
  - Предпочтение `step_execute_single` для одиночных шагов и `step_execute_many` только для последовательностей >=2 шагов.

## Набор задач (6 прогонов)
Запускай каждую задачу отдельным вызовом `gemini` с собственным промптом. После выполнения фиксируй успешность, артефакты (логи MCP, скриншоты) и проблемы.

1) **Exploration (простое)** — вход в систему:
   - Промпт: `Создай headed-сессию через test_engine и выполни простой вход в Syngrisi через готовые шаги. Покажи вывод успешной авторизации. Соблюдай правила селекторов и запрет на таймаут-хаки.`
2) **Exploration (комбинированное)** — проверки через API + UI:
   - Промпт: `Создай headed-сессию. Сначала через готовые API-степы создай новый check, получи его статус, затем зайди в UI и примени этот check. Используй только доступные шаги, одиночные действия через step_execute_single.`
3) **Generation (простой тест)** — генерация фичи логина:
   - Промпт: `Сгенерируй и выполни простой BDD-тест логина, используя существующие step definitions и правила селекторов. После генерации запусти тест через MCP и покажи результат.`
4) **Generation (сложный тест)** — жизненный цикл check с прекондишенами:
   - Промпт: `Сгенерируй сложный тест жизненного цикла check (создание -> изменение -> approve -> reject), добавь прекондишены. Используй доступные шаги и не ослабляй ожидания. Запусти тест через MCP и приложи логи.`
5) **Debug** — поломка UI и фикc:
   - Промпт: `Нарушь работу одного UI-элемента (например, скрыть кнопку) и попроси агента найти и починить проблему, следуя правилам отладки из AGENTS.md. Зафиксируй, какие селекторы использовались и как исправлено.`
6) **Creation** — новый step definition + проверка в тесте:
   - Промпт: `Создай простой step definition (например, проверка badge), добавь его в шаги, пересобери каталог шагов через MCP, затем используй его в коротком тесте и запусти через MCP. Все комментарии в коде на английском.`

## Фиксация результатов
- Для каждого прогона собирай: промпт, итог (pass/fail), путь к логам MCP (`packages/syngrisi/e2e/support/mcp/logs`), скриншоты при наличии.
- Если агент нарушает правила (таймауты, селекторы, игнорирование AGENTS.md) — отмечай как fail с описанием.
- После серии прогонов сформируй краткий отчет по стабильности и проблемным зонам.
